# アニメーション制作アプリ仕様書

## プロジェクト概要
プロのイラストレーター向けのアニメーション制作（作画）アプリケーション。高パフォーマンスを実現するため、描画エンジンはWebAssembly (WASM) + WebGPUで実装し、UIはReactで開発する。

## 技術スタック
- **フロントエンド**: React + TypeScript
- **パッケージマネージャー**: Deno
- **スタイリング**: TailwindCSS v4 + @tailwindcss/vite
- **バックエンド**: Rust (Tauri)
- **フレームワーク**: Tauri
- **描画エンジン**: 
  - **メイン**: WebAssembly (WASM) + wgpu (WebGPU/WebGL)
  - **フォールバック**: HTML5 Canvas 2D API
- **状態管理**: jotai
- **プラグイン実行環境**: QuickJS-emscripten（将来実装）

### 主要依存関係
**Rust (Cargo.toml) - 現在インストール済み**
- tauri 2.6.0 (アプリケーションフレームワーク)
- tauri-build 2.0 (ビルドツール)
- serde 1.0 (シリアライゼーション)
- serde_json 1.0 (JSON処理)
- image 0.25 (画像処理)
- tokio 1.40 (非同期ランタイム)
- log 0.4 (ログ出力)
- env_logger 0.11 (ログ管理)

**WASM描画エンジン (src-wasm/Cargo.toml)**
- wgpu 0.20 (WebGPU/WebGL描画エンジン)
- wasm-bindgen 0.2 (WASM-JSバインディング)
- web-sys 0.3 (Web API)
- js-sys 0.3 (JavaScript API)
- bytemuck 1.16 (メモリレイアウト)
- serde 1.0 (シリアライゼーション)
- serde_json 1.0 (JSON処理)
- wasm-bindgen-futures 0.4 (非同期処理)

**将来追加予定**
- roxmltree (xdts形式対応)

**React/TypeScript (package.json)**
- @tailwindcss/vite 4.1.11 (最新Vite統合)
- jotai 2.12.5 (状態管理)
- @tauri-apps/api 2.6.0 (Tauri API)
- vitest 2.1.9 (テストランナー)
- @testing-library/react 16.1.0 (テストライブラリ)
- jsdom 26.0.3 (DOM環境)

## 基本仕様
- **プロジェクト単位**: 1プロジェクト = 1カット
- **最大キャンバスサイズ**: 4K (3840×2160)
- **レイヤー数上限**: 10枚/フレーム
- **フレームレート**: 最大60fps対応
- **ペン遅延**: 限りなく少ない状態を目指す

## 機能要件

### 優先度：高（MVP）

#### 1. 描画基本機能
- ペン/ブラシツール（筆圧対応）
- 消しゴムツール
- 塗りつぶしツール
- 選択ツール（矩形、投げ縄、自動選択）
- 選択範囲の変形（移動、拡大縮小、回転）

#### 2. レイヤー機能
- 最大10レイヤー/フレーム
- 基本ブレンドモード（通常、乗算、スクリーン、オーバーレイ）
- 不透明度調整
- 固定レイヤー（全フレーム共通）

#### 3. アニメーション機能
- xdts形式（東映デジタルタイムシート）の読み込み/書き出し
- タイムシート編集
- オニオンスキン（前後5フレーム、透明度調整可）
- フレーム間のコピー＆ペースト
- 中割り機能

#### 4. ファイル入出力
- プロジェクトファイル（独自形式）
- 連番PNG/JPEG出力
- PSD読み込み（基本的なレイヤー構造のみ）

### 優先度：中

#### 1. 描画拡張機能
- ベクター描画/編集機能
- カスタムブラシ作成機能
- 基本的な図形ツール（円、四角、直線）
- 手ぶれ補正（工数次第で後回し可）

#### 2. アニメーション拡張
- GIFアニメーション出力
- MP4出力（ffmpeg連携）
- プレビュー機能の高度化

#### 3. UI/UX改善
- ショートカットカスタマイズ
- ワークスペースレイアウト保存

### 優先度：低（将来実装）

#### 1. プロフェッショナル機能
- カラープロファイル対応
- 音声トラック同期
- マルチプラットフォーム対応（Windows/Mac/Linux）

#### 2. プラグインシステム
- TypeScriptベースのプラグイン
- セキュアな実行環境（QuickJS-emscripten）
- 独自パッケージ形式での配布
- セマンティックバージョニング採用

## メモリ

### 開発メモ
- コードベースの変更を行った際は最終ステップで必ずTypeScriptのビルドチェックを行ってください