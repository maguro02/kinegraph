<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kinegraph - create_project Manual Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            padding: 15px;
            border-radius: 4px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #005999;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .error-button {
            background: #dc3545;
        }
        
        .error-button:hover {
            background: #c82333;
        }
        
        .log-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        
        .log-info { color: #007acc; }
        .log-error { color: #dc3545; font-weight: bold; }
        .log-debug { color: #6c757d; }
        .log-warn { color: #fd7e14; }
        
        input, select {
            margin: 5px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        
        .input-group {
            margin: 10px 0;
        }
        
        .input-group label {
            display: inline-block;
            width: 100px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Kinegraph - create_project Manual Test</h1>
        <p>ã“ã®ç”»é¢ã§create_project APIã®å„ç¨®ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚<br>
        é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¿ãƒ–ã‚’é–‹ã„ã¦ã€è©³ç´°ãªãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>

        <!-- æ­£å¸¸ã‚±ãƒ¼ã‚¹ -->
        <div class="test-section">
            <h3>âœ… æ­£å¸¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
            <div class="input-group">
                <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå:</label>
                <input type="text" id="normalName" value="Test Project" />
            </div>
            <div class="input-group">
                <label>å¹…:</label>
                <input type="number" id="normalWidth" value="1920" />
                <label>é«˜ã•:</label>
                <input type="number" id="normalHeight" value="1080" />
                <label>FPS:</label>
                <input type="number" id="normalFps" value="24" />
            </div>
            <button onclick="testNormalCase()">æ­£å¸¸ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</button>
        </div>

        <!-- ç„¡åŠ¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼ -->
        <div class="test-section">
            <h3>âŒ ç„¡åŠ¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ</h3>
            <button class="error-button" onclick="testEmptyName()">ç©ºæ–‡å­—åã‚¨ãƒ©ãƒ¼</button>
            <button class="error-button" onclick="testNegativeWidth()">è² ã®å¹…ã‚¨ãƒ©ãƒ¼</button>
            <button class="error-button" onclick="testZeroHeight()">ã‚¼ãƒ­é«˜ã•ã‚¨ãƒ©ãƒ¼</button>
            <button class="error-button" onclick="testInvalidFrameRate()">ç„¡åŠ¹FPSã‚¨ãƒ©ãƒ¼</button>
            <button class="error-button" onclick="testOversizedCanvas()">å·¨å¤§ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¨ãƒ©ãƒ¼</button>
        </div>

        <!-- è¤‡æ•°å›å‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3>ğŸ”„ è¤‡æ•°å›å‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="testConcurrentCalls()">åŒæ™‚è¤‡æ•°å‘¼ã³å‡ºã—</button>
            <button onclick="testRapidCalls()">é«˜é€Ÿé€£ç¶šå‘¼ã³å‡ºã—</button>
            <button onclick="testBulkCalls()">å¤§é‡ä¸¦åˆ—å‘¼ã³å‡ºã—</button>
        </div>

        <!-- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼ -->
        <div class="test-section">
            <h3>âš ï¸ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ</h3>
            <button class="error-button" onclick="testBackendNotReady()">æœªåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼</button>
            <button class="error-button" onclick="testIPCError()">IPCé€šä¿¡ã‚¨ãƒ©ãƒ¼</button>
            <button class="error-button" onclick="testTimeoutError()">ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼</button>
        </div>

        <!-- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3>ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="testSystemInfo()">ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±å–å¾—</button>
            <button onclick="testDebugInit()">ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°åˆæœŸåŒ–</button>
        </div>

        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="testLargeProject()">å¤§å‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</button>
            <button onclick="testMemoryStress()">ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ</button>
        </div>

        <!-- ãƒ­ã‚°å‡ºåŠ›ã‚¨ãƒªã‚¢ -->
        <div class="test-section">
            <h3>ğŸ“‹ ãƒ­ã‚°å‡ºåŠ›</h3>
            <button onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
            <div id="logOutput" class="log-output"></div>
        </div>
    </div>

    <script type="module">
        // Tauri APIã®å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆé–‹ç™ºæ™‚ã®ã¿åˆ©ç”¨å¯èƒ½ï¼‰
        let tauriAPI = null;
        
        try {
            // æœ¬æ¥ã®Tauriç’°å¢ƒã§ã®ã¿å‹•ä½œ
            tauriAPI = await import('/src/lib/tauri.ts');
        } catch (error) {
            console.warn('Tauri API not available in this environment:', error);
        }

        // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
        function addLog(level, message, data = '') {
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toISOString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${level}`;
            
            let logText = `[${timestamp}] [${level.toUpperCase()}] ${message}`;
            if (data && typeof data === 'object') {
                logText += ` ${JSON.stringify(data, null, 2)}`;
            } else if (data) {
                logText += ` ${data}`;
            }
            
            logEntry.textContent = logText;
            logOutput.appendChild(logEntry);
            logOutput.scrollTop = logOutput.scrollHeight;
            
            // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚å‡ºåŠ›
            console[level](logText);
        }

        // ãƒ¢ãƒƒã‚¯é–¢æ•°ï¼ˆTauriç’°å¢ƒå¤–ã§ã®å‹•ä½œç”¨ï¼‰
        function createMockProject(name, width, height, frameRate) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªã®æ¨¡æ“¬
                    if (!name) {
                        reject(new Error('Project name cannot be empty'));
                    } else if (width <= 0) {
                        reject(new Error('Width must be positive'));
                    } else if (height <= 0) {
                        reject(new Error('Height must be positive'));
                    } else if (frameRate <= 0 || frameRate > 120) {
                        reject(new Error('Frame rate must be between 1 and 120'));
                    } else if (width > 8192 || height > 8192) {
                        reject(new Error('Canvas size exceeds maximum allowed dimensions'));
                    } else {
                        resolve({
                            id: `mock-project-${Date.now()}`,
                            name,
                            width,
                            height,
                            frameRate,
                            frames: [],
                            createdAt: new Date().toISOString()
                        });
                    }
                }, Math.random() * 1000 + 500); // 500-1500ms ã®ãƒ©ãƒ³ãƒ€ãƒ é…å»¶
            });
        }

        // ãƒ†ã‚¹ãƒˆé–¢æ•°ç¾¤
        window.testNormalCase = async function() {
            const name = document.getElementById('normalName').value;
            const width = parseInt(document.getElementById('normalWidth').value);
            const height = parseInt(document.getElementById('normalHeight').value);
            const fps = parseInt(document.getElementById('normalFps').value);
            
            addLog('info', 'æ­£å¸¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹', { name, width, height, fps });
            
            try {
                let result;
                if (tauriAPI) {
                    result = await tauriAPI.createProject(name, width, height, fps);
                } else {
                    result = await createMockProject(name, width, height, fps);
                }
                addLog('info', 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæˆåŠŸ', result);
            } catch (error) {
                addLog('error', 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã‚¨ãƒ©ãƒ¼', error.message);
            }
        };

        window.testEmptyName = async function() {
            addLog('info', 'ç©ºæ–‡å­—åã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹');
            try {
                let result;
                if (tauriAPI) {
                    result = await tauriAPI.createProject('', 1920, 1080, 24);
                } else {
                    result = await createMockProject('', 1920, 1080, 24);
                }
            } catch (error) {
                addLog('error', 'æœŸå¾…ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ', error.message);
            }
        };

        window.testNegativeWidth = async function() {
            addLog('info', 'è² ã®å¹…ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹');
            try {
                let result;
                if (tauriAPI) {
                    result = await tauriAPI.createProject('Test', -100, 1080, 24);
                } else {
                    result = await createMockProject('Test', -100, 1080, 24);
                }
            } catch (error) {
                addLog('error', 'æœŸå¾…ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ', error.message);
            }
        };

        window.testZeroHeight = async function() {
            addLog('info', 'ã‚¼ãƒ­é«˜ã•ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹');
            try {
                let result;
                if (tauriAPI) {
                    result = await tauriAPI.createProject('Test', 1920, 0, 24);
                } else {
                    result = await createMockProject('Test', 1920, 0, 24);
                }
            } catch (error) {
                addLog('error', 'æœŸå¾…ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ', error.message);
            }
        };

        window.testInvalidFrameRate = async function() {
            addLog('info', 'ç„¡åŠ¹FPSã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹');
            try {
                let result;
                if (tauriAPI) {
                    result = await tauriAPI.createProject('Test', 1920, 1080, 0);
                } else {
                    result = await createMockProject('Test', 1920, 1080, 0);
                }
            } catch (error) {
                addLog('error', 'æœŸå¾…ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ', error.message);
            }
        };

        window.testOversizedCanvas = async function() {
            addLog('info', 'å·¨å¤§ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹');
            try {
                let result;
                if (tauriAPI) {
                    result = await tauriAPI.createProject('Test', 50000, 50000, 24);
                } else {
                    result = await createMockProject('Test', 50000, 50000, 24);
                }
            } catch (error) {
                addLog('error', 'æœŸå¾…ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ', error.message);
            }
        };

        window.testConcurrentCalls = async function() {
            addLog('info', 'åŒæ™‚è¤‡æ•°å‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            const promises = [
                tauriAPI ? 
                    tauriAPI.createProject('Project 1', 1920, 1080, 24) : 
                    createMockProject('Project 1', 1920, 1080, 24),
                tauriAPI ? 
                    tauriAPI.createProject('Project 2', 1920, 1080, 30) : 
                    createMockProject('Project 2', 1920, 1080, 30),
                tauriAPI ? 
                    tauriAPI.createProject('Project 3', 1920, 1080, 60) : 
                    createMockProject('Project 3', 1920, 1080, 60)
            ];
            
            const results = await Promise.allSettled(promises);
            results.forEach((result, index) => {
                if (result.status === 'fulfilled') {
                    addLog('info', `ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ${index + 1} ä½œæˆæˆåŠŸ`, result.value);
                } else {
                    addLog('error', `ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ${index + 1} ä½œæˆå¤±æ•—`, result.reason.message);
                }
            });
        };

        window.testRapidCalls = async function() {
            addLog('info', 'é«˜é€Ÿé€£ç¶šå‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            for (let i = 0; i < 5; i++) {
                try {
                    let result;
                    if (tauriAPI) {
                        result = await tauriAPI.createProject(`Rapid ${i}`, 1920, 1080, 24);
                    } else {
                        result = await createMockProject(`Rapid ${i}`, 1920, 1080, 24);
                    }
                    addLog('info', `é«˜é€Ÿå‘¼ã³å‡ºã— ${i + 1} æˆåŠŸ`, result.id);
                } catch (error) {
                    addLog('error', `é«˜é€Ÿå‘¼ã³å‡ºã— ${i + 1} å¤±æ•—`, error.message);
                }
            }
        };

        window.testBulkCalls = async function() {
            addLog('info', 'å¤§é‡ä¸¦åˆ—å‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆé–‹å§‹ï¼ˆ10å€‹ï¼‰');
            
            const promises = Array.from({ length: 10 }, (_, i) =>
                tauriAPI ? 
                    tauriAPI.createProject(`Bulk ${i}`, 1920, 1080, 24) : 
                    createMockProject(`Bulk ${i}`, 1920, 1080, 24)
            );
            
            const results = await Promise.allSettled(promises);
            const successes = results.filter(r => r.status === 'fulfilled').length;
            const failures = results.filter(r => r.status === 'rejected').length;
            
            addLog('info', `å¤§é‡ä¸¦åˆ—ãƒ†ã‚¹ãƒˆçµæœ: æˆåŠŸ ${successes}ä»¶, å¤±æ•— ${failures}ä»¶`);
        };

        window.testBackendNotReady = function() {
            addLog('error', 'ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ï¼ˆæ¨¡æ“¬ï¼‰', 'Tauri backend not initialized');
        };

        window.testIPCError = function() {
            addLog('error', 'IPCé€šä¿¡ã‚¨ãƒ©ãƒ¼ï¼ˆæ¨¡æ“¬ï¼‰', 'IPC channel disconnected');
        };

        window.testTimeoutError = function() {
            addLog('error', 'ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼ï¼ˆæ¨¡æ“¬ï¼‰', 'Operation timed out');
        };

        window.testSystemInfo = async function() {
            addLog('info', 'ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±å–å¾—ãƒ†ã‚¹ãƒˆé–‹å§‹');
            try {
                if (tauriAPI) {
                    const systemInfo = await tauriAPI.getSystemInfo();
                    addLog('info', 'ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±å–å¾—æˆåŠŸ', systemInfo);
                } else {
                    addLog('info', 'ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±å–å¾—æˆåŠŸï¼ˆæ¨¡æ“¬ï¼‰', 'Mock system info');
                }
            } catch (error) {
                addLog('error', 'ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼', error.message);
            }
        };

        window.testDebugInit = async function() {
            addLog('info', 'ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹');
            try {
                if (tauriAPI) {
                    await tauriAPI.initializeDebugLogging();
                    addLog('info', 'ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°åˆæœŸåŒ–å®Œäº†');
                } else {
                    addLog('info', 'ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°åˆæœŸåŒ–å®Œäº†ï¼ˆæ¨¡æ“¬ï¼‰');
                }
            } catch (error) {
                addLog('error', 'ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼', error.message);
            }
        };

        window.testLargeProject = async function() {
            addLog('info', 'å¤§å‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆãƒ†ã‚¹ãƒˆé–‹å§‹ï¼ˆ4Kè§£åƒåº¦ï¼‰');
            try {
                let result;
                if (tauriAPI) {
                    result = await tauriAPI.createProject('Large Project', 3840, 2160, 60);
                } else {
                    result = await createMockProject('Large Project', 3840, 2160, 60);
                }
                addLog('info', 'å¤§å‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæˆåŠŸ', result);
            } catch (error) {
                addLog('error', 'å¤§å‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã‚¨ãƒ©ãƒ¼', error.message);
            }
        };

        window.testMemoryStress = async function() {
            addLog('info', 'ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹');
            const startMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            
            for (let i = 0; i < 20; i++) {
                try {
                    let result;
                    if (tauriAPI) {
                        result = await tauriAPI.createProject(`Stress ${i}`, 1920, 1080, 24);
                    } else {
                        result = await createMockProject(`Stress ${i}`, 1920, 1080, 24);
                    }
                } catch (error) {
                    addLog('warn', `ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ ${i} ã§ã‚¨ãƒ©ãƒ¼`, error.message);
                }
            }
            
            const endMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            const memoryDiff = endMemory - startMemory;
            addLog('info', `ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº† - ãƒ¡ãƒ¢ãƒªå¢—åŠ : ${memoryDiff} bytes`);
        };

        window.clearLogs = function() {
            document.getElementById('logOutput').innerHTML = '';
        };

        // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        addLog('info', 'Manual Test Page åˆæœŸåŒ–å®Œäº†');
        if (tauriAPI) {
            addLog('info', 'Tauri API ãŒåˆ©ç”¨å¯èƒ½ã§ã™');
        } else {
            addLog('warn', 'Tauri API ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ - ãƒ¢ãƒƒã‚¯APIã‚’ä½¿ç”¨ã—ã¾ã™');
        }
    </script>
</body>
</html>